# ウォーキングトラッカー 要求定義書

## 1. 概要

### 1.1 目的
日々のウォーキングを記録し、運動習慣の継続をサポートするモバイルアプリケーション。

### 1.2 対象プラットフォーム
- iOS
- Android

### 1.3 技術スタック
- React Native (Expo SDK ~54.0)
- TypeScript
- Expo Router (ファイルベースルーティング)
- NativeWind (Tailwind CSS for React Native)

---

## 2. 機能要件

### 2.1 ウォーキング記録機能

#### 2.1.1 開始機能
| 項目 | 内容 |
|------|------|
| トリガー | 開始ボタンをタップ |
| 処理内容 | ウォーキング開始時間を記録 |
| 記録データ | 開始日時（タイムスタンプ） |
| 画面表示 | 経過時間のリアルタイム表示を開始 |

#### 2.1.2 一時停止機能
| 項目 | 内容 |
|------|------|
| トリガー | 一時停止ボタンをタップ（記録中のみ表示） |
| 処理内容 | タイマーとGPS追跡を一時停止、累積時間を保存 |
| 画面表示 | 再開ボタンと終了ボタンを表示 |

#### 2.1.3 再開機能
| 項目 | 内容 |
|------|------|
| トリガー | 再開ボタンをタップ（一時停止中のみ表示） |
| 処理内容 | タイマーとGPS追跡を再開、累積時間を維持 |
| 画面表示 | 一時停止ボタンと終了ボタンを表示 |

#### 2.1.4 終了機能
| 項目 | 内容 |
|------|------|
| トリガー | 終了ボタンをタップ（記録中または一時停止中に表示） |
| 処理内容 | ウォーキング終了時間を記録、各種データを計算 |
| 記録データ | 終了日時、ウォーキング時間、ウォーキング距離 |
| 画面表示 | ウォーキング時間、ウォーキング距離を表示 |

#### 2.1.5 計算ロジック
- **ウォーキング時間**: 実際に歩行した時間の累積（一時停止中の時間は含まない）
- **ウォーキング距離**: GPS座標の変化から累積距離を算出（一時停止中は計測しない）

### 2.2 気分登録機能

#### 2.2.1 概要
ウォーキング終了時に、その時点での気分を記録できる。

#### 2.2.2 気分の選択肢
| 気分 | アイコン例 | 説明 |
|------|-----------|------|
| とても良い | 😄 | 爽快、達成感がある |
| 良い | 🙂 | 気持ちが良い |
| 普通 | 😐 | 特に変化なし |
| あまり良くない | 😕 | 少し疲れた |
| 良くない | 😞 | 疲労感が強い |

#### 2.2.3 登録タイミング
- ウォーキング終了直後に気分選択画面を表示
- スキップも可能とする

---

## 3. 画面構成

### 3.1 ホーム画面（メイン画面）
- 状態に応じたボタン表示
- 現在のウォーキング状態表示
  - 未開始時: 開始ボタン
  - 記録中: 経過時間、現在の距離、一時停止ボタン、終了ボタン
  - 一時停止中: 経過時間（停止）、現在の距離、再開ボタン、終了ボタン
- 直近の記録サマリー

### 3.2 記録結果画面
- ウォーキング時間
- ウォーキング距離
- 気分選択UI
- 保存ボタン

### 3.3 履歴画面（将来拡張）
- 過去の記録一覧
- 日付、時間、距離、気分の表示

---

## 4. データ構造

### 4.1 ウォーキング記録
```typescript
interface WalkingRecord {
  id: string;                    // 一意のID
  startTime: Date;               // 開始時間
  endTime: Date;                 // 終了時間
  duration: number;              // ウォーキング時間（秒）
  distance: number;              // ウォーキング距離（メートル）
  mood?: MoodType;               // 気分（オプション）
  createdAt: Date;               // 作成日時
}

type MoodType = 'excellent' | 'good' | 'normal' | 'not_good' | 'bad';

type WalkingState = 'idle' | 'walking' | 'paused' | 'finished';
```

### 4.2 位置情報（記録中に使用）
```typescript
interface LocationPoint {
  latitude: number;              // 緯度
  longitude: number;             // 経度
  timestamp: Date;               // 取得時間
  accuracy?: number;             // 精度（メートル）
}
```

---

## 5. 非機能要件

### 5.1 パフォーマンス
- GPS取得間隔: 5秒ごと（バッテリー消費とのバランス）
- 画面更新: 1秒ごと（経過時間表示）

### 5.2 データ保存
- ローカルストレージに保存（AsyncStorage または Expo SecureStore）
- 将来的にクラウド同期を検討

### 5.3 権限
- 位置情報の取得許可（前面使用時）
- バックグラウンド位置情報（オプション、将来拡張）

### 5.4 オフライン対応
- インターネット接続なしでも基本機能は動作

---

## 6. ユーザーフロー

```
[アプリ起動]
    ↓
[ホーム画面]
    ↓
[開始ボタンをタップ]
    ↓
[ウォーキング記録中] ← 経過時間・距離をリアルタイム表示
    ↓
    ├─[一時停止ボタンをタップ]
    │     ↓
    │  [一時停止中] ← タイマー・GPS停止
    │     ↓
    │     ├─[再開ボタンをタップ] → [ウォーキング記録中]へ戻る
    │     └─[終了ボタンをタップ] → [記録結果画面]へ
    │
    └─[終了ボタンをタップ]
          ↓
[記録結果画面] ← 時間・距離を表示
    ↓
[気分を選択]
    ↓
[保存]
    ↓
[ホーム画面へ戻る]
```

---

## 7. 将来の拡張案

- 履歴画面での記録一覧表示
- 統計・グラフ表示（週間/月間サマリー）
- 目標設定機能
- ウォーキングルートの地図表示
- SNS共有機能
- Apple Health / Google Fit 連携

---

## 8. 開発フェーズ

### Phase 1（MVP）
- [x] プロジェクトセットアップ
- [x] ホーム画面の実装
- [x] 開始/終了ボタンの実装
- [x] 時間計測機能
- [x] GPS による距離計測
- [x] 気分登録機能
- [x] ローカルストレージへの保存
- [x] 一時停止/再開機能

### Phase 2
- [ ] 履歴画面の実装
- [ ] UI/UX の改善
- [ ] バックグラウンド計測対応

### Phase 3
- [ ] 統計・グラフ機能
- [ ] ヘルスケアアプリ連携
